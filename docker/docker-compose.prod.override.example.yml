# Example production override for server-specific configuration
# Copy this to docker-compose.prod.override.yml and customize for your server
# 
# Usage:
#   docker compose -f docker/docker-compose.prod.yml -f docker/docker-compose.prod.override.yml up -d
#
# Or set COMPOSE_FILE environment variable:
#   export COMPOSE_FILE=docker/docker-compose.prod.yml:docker/docker-compose.prod.override.yml
#   docker compose up -d
#
# Required .env variables:
#   NGINX_PROXY_NETWORK - Name of the nginx-proxy network (e.g., nginx-proxy)
#   VIRTUAL_HOST        - Domain name for nginx-proxy (e.g., your-domain.com)
#   VIRTUAL_PORT        - Port to expose (default: 3000)
#   LETSENCRYPT_HOST    - Domain for Let's Encrypt certificate
#   LETSENCRYPT_EMAIL   - Email for Let's Encrypt notifications
#
# App secrets (NEXTAUTH_URL, NEXTAUTH_SECRET, SPOTIFY_*) are loaded from .env via env_file

services:
  web:
    # Custom network for nginx-proxy
    networks:
      - nginx-proxy
      - default

    # Environment variables for Let's Encrypt / nginx-proxy
    environment:
      # Virtual host for nginx-proxy
      - VIRTUAL_HOST=${VIRTUAL_HOST}
      - VIRTUAL_PORT=${VIRTUAL_PORT:-3000}
      
      # Let's Encrypt configuration
      - LETSENCRYPT_HOST=${LETSENCRYPT_HOST}
      - LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL}

    # Custom labels (if using Traefik instead of nginx-proxy)
    # labels:
    #   - "traefik.enable=true"
    #   - "traefik.http.routers.listmagify.rule=Host(`${VIRTUAL_HOST}`)"
    #   - "traefik.http.routers.listmagify.entrypoints=websecure"
    #   - "traefik.http.routers.listmagify.tls.certresolver=letsencrypt"
    #   - "traefik.http.services.listmagify.loadbalancer.server.port=${VIRTUAL_PORT:-3000}"

# External network for nginx-proxy
networks:
  nginx-proxy:
    external: true
    name: ${NGINX_PROXY_NETWORK:-nginx-proxy}
